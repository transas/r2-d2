% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[11pt]{book} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)
\usepackage[russian]{babel}

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margin=2in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options

% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{indentfirst}

\parskip=10pt

%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
%\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!

%%% END Article customizations

%%% The "real" document content comes below...

\title{R2D2.ironbot: Руководство пользователя}
\author{И. Меркин}
%\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
\maketitle

\tableofcontents

\chapter{Базовые сведения}

R2D2.ironbot входит в набор модулей R2D2 и является модулем расширения для фреймворка robot. Модуль предоставляет функциональность для автоматизации традиционных интерфейсов пользователя под Windows. При этом в качестве средства работы с пользовательскими интерфейсами выступает библиотека White (.Net), вследствие чего предполагается запуск фреймворка robot не из-под CPython, а из-под IronPython.

\section{Инсталляция и включение в проект}

Здесь будет интересный и увлекательный рассказ про стучание головой о клавиатуру в процессе инсталляции. Надо написать про:
Python, wxWidgets, RIDE, IronPython, lxml, log4net, White, Castle.Core.


\section{Ключевые слова и их параметры: общий подход}

R2D2.ironbot реализует множество ключевых слов robot, обеспечивающих запуск и контроль работы приложений, поиск элементов пользовательского интерфейса и управление ими.
В основу дизайна этих ключевых слов положены два общих правила. Первое касается именования самих ключевых слов. Все ключевые слова делятся на несколько групп, и имя каждого ключевого слова всегда начинается с имени группы. Так, группа \verb"App" обеспечивает работу с приложениями (запуск, контроль выполнения и т.п.), а группа \verb"Wnd" --- с окнами. Соответственно, типичное название ключевого слова из группы \verb"App" --- \verb"App Launch" (сначала группа, потом характер действия), а из группы \verb"Wnd"  --- \verb"Wnd Close".

Второе правило касается набора параметров, принимаемых ключевыми словами. В соответствии с принятыми соглашениями, ключевые слова R2D2.ironbot имеют два вида параметров --- позиционные и именованые. Позиционные параметры всегда идут первыми и представляют собой традиционные параметры ключевых слов robot. Именованые параметры следуют после позиционных, обычно в произвольной последовательности. Каждый именованый параметр может представлять собой конструкцию из одного или более параметров ключевого слова robot, первый из которых --- имя параметра, а последующие --- набор значений параметра (допускаются именованые параметры с произвольным количеством значений; параметр, не имеющий значений, называется далее в описании \emph{флагом}, т.к. для него важен только сам факт присутствия).

Рассмотрим примеры задания параметров на типичном ключевом слове. Ниже мы видим ключевое слово \verb"App Launch", предназначенное для запуска приложений:

\begin{verbatim}
App Launch    ipy.exe    params    ../winforms.py    test_teardown
\end{verbatim}

Здесь присутствует один позиционный параметр, путь к файлу приложения. Этот параметр является обязательным, без него ключевое слово не имело бы смысла, вследствие чего он и был сделан позиционным. На этом позиционные параметры кончаются, далее следуют именованые.

Именованый параметр \verb"params" имеет одно значение, и это значение --- строка аргументов, которая будет передана приложению при запуске (\verb"../winforms.py"). Параметр не является обязательным. Обратите внимание, что в данном случае один именованый параметр представлен двумя параметрами ключевого слова robot. В популярной среде разработки RIDE, где ключевые слова и их параметры представляются ячейками таблицы, этот именованый параметр займёт две ячейки.

Именованый параметр \verb"test_teardown" является типичным \emph"флагом". За ним не идёт никакое дополнительное значение, важен сам факт присутствия флага среди именованых параметров. В данном случае параметр означает, что в том случае, если до конца теста (test teardown --- термин, означающий код, выполняемый при деинициализации теста) приложение не завершится естественным образом, то при деинициализации теста приложение должно быть аварийно завершено.

Характерно, что ту же самую команду можно записать и следующим образом, переставив именованые параметры между собой:

\begin{verbatim}
App Launch    ipy.exe    test_teardown    params    ../winforms.py
\end{verbatim}


\section{Спецификация времени ожидания}

В тех случаях, когда в значении параметра ключевого слова следует указать время ожидания, существуют два способа это сделать. Во-первых, можно указать точное время ожидания, не зависящее от производительности компьютера. Это делается путём задания в качестве значения параметра вещественного числа с постфиксом \verb"s" (секунды), \verb"ms" (миллисекунды), \verb"m" (минуты), \verb"h" (часы). Во-вторых, можно указать время, скорректированное с учётом оценки производительности компьютера (оценка производительности производится с помощью ключевых слов группы \verb"Benchmark", см. описание слов этой группы), т.е. на медленном компьютере в действительности пройдёт больше времени, а на быстром --- меньше. Для этого к спецификации времени в начале приписывается символ \verb"~". Кроме того, можно описать бесконечную задержку, указав в качестве спецификации задержки слово \verb"forever".

Вот примеры корректных спецификаций времени: \verb"10s", \verb"0.5s", \verb"10ms", \verb"~10s", \verb"~0.5m", \verb"~10h",  \verb"forever".

\section{Наиболее распространённые именованые параметры}
Рассматриваемые ниже именованые параметры применимы ко многим ключевым словам. Эти параметры можно разделить на три группы: параметры, задающие критерии успешности поиска или фильтрации; параемтр, задающий время ожидания; параметр, заставляющий ключевое слово потерпеть неудачу, если не удалось дождаться требуемого другими параметрами состояния объекта или объектов.

\subsection{Ожидание}

В тех случаях, когда ключевое слово ждёт желаемого результата (открытие окна или окон, появление элементов пользовательского интерфейса, старт или завершение приложения), оно всегда может принимать именованый параметр \verb|timeout|, значением которого является спецификация времени ожидания. Наличие этого параметра заставляет ключевое слово изменить свою работу. Если без него выполняется однократная проверка состояния объекта или объектов и возврат результата, соответствующего итогам проверки, то добавление параметра \verb|timeout| заставляет ключевое слово повторять попытки либо до тех пор, когда результат будет соответствовать ожидаемому, либо до тех пор, пока величина тайм-аута истечёт (что наступит раньше).

Например, следующее ключевое слово будет ждать завершения приложения в течение не более чем 5 секунд, вернув \verb|True|, если дождётся, и \verb|False|, если нет:
\begin{verbatim}
App State    ${app}    not_running    timeout    5s
\end{verbatim}

Если бы тайм-аут не был указан, ключевое слово вернуло бы результат после первой же попытки. Для не ограниченного по времени ожидания используется \verb|timeout    forever|.


\subsection{Критерии успешности поиска или фильтрации}
Подавляющее большинство ключевых слов, выполняющих поиск, фильтрацию и контроль за состоянием объектов (поиск окон и контролов, управление состоянием приложений и т.п.), помимо ожидания, поддерживает несколько именованых параметров, позволяющих очень широко варьировать действие ключевого слова. Таки ключевые слова обычно могут работать не только с отдельными объектами, но и со списками объектов (например, ключевое слово \verb|App State| работает как с одним приложением, так и со списком приложений). При этом операция выполняется с каждым приложением из списка. Важной особенностью работы со списком является то, что состояния объектов могут не быть одинаковыми (допустим, в случае \verb|App State| только часть приложений может завершиться). А в случае операций поиска найденное количество объектов может изменяться со временем (например, поиск окон работает именно так, если окна открываются или закрываются во время его работы).

В то же время, понятие <<ожидаемый результат>> может быть различно в зависимости от потребностей пользователя. Иногда нужно дождаться, пока хотя бы одно из приложений завершится. Иногда нужно дождаться открытия ровно двух окон, подпадающих под запрос поиска, а иногда надо убедится, что ни один объект не подпадает под запрос. Для реализации такой функциональности существует группа именованых параметров, которая включает:
\begin{itemize}
\item \verb|all| (флаг) --- все объекты должны достичь требуемого состояния;
\item \verb|any| (флаг) --- любой из объектов должен достичь требуемого состояния;
\item \verb|single| (флаг) --- ровно один из объектов должен достичь требуемого состояния, результат операции --- не список, а одиночный объект либо \verb|None| (допустимо комбинирование с \verb|none|, означающее <<ноль или один>>);
\item \verb|none| (флаг) --- ровно один из объектов должен достичь требуемого состояния, результат операции --- булевский (при комбинировании с \verb|single| -- объект либо \verb|None|);
\item \verb|number| (значение --- целое число) --- требуемого состояния должны достичь ровно столько объектов, сколько указано значением параметра (результат --- список).
\end{itemize}

\subsection{Атрибуты объектов и операции над ними}

Библиотека R2D2.Ironbot манипулирует значительным количеством разнообразных объектов, в основном связанных с пользовательским интерфейсом. В принятом в данной библиотеке понимании, объекты обладают атрибутами, и различные ключевые слова библиотеки так или иначе с этими атрибутами имеют дело. Атрибуты используются при фильтрации искомых объектов, при выполнении над объектами различных действий, при получении сведений о них и т.п. Над атрибутами производятся различные операции (например, \verb|get| --- взятие значения, \verb|set| --- запись значения, \verb|wait| --- фильтрация путём сравнения знаения с образцом, которую можно использовать для ожидания, \verb|do| --- выполнение атрибута-действия). Не каждый атрибут поддерживает все возможные операции, так, есть атрибуты только для чтения, атрибуты для чтения и записи, наконец, атрибуты-действия, например, атрибут \verb|click|, поддерживающий единственную операцию \verb|do|, которая выполняет щелчок мыши на объекте.

Когда в параметрах ключевого слова упоминаются атрибуты, указываются имя действия и имя атрибута, разделённые пробелом, за которыми могут идти дополнительные значения:

\begin{verbatim}
do click
set idx_selected    5
get id
wait automation_id    MY_AID
\end{verbatim}

В некоторых случаях допускается не указывать действие, а только имя атрибута. Это значит, что используется то действие, которое наиболее характерно для выполняемого ключевого слова. Так, ключевые слова поиска обычно позволяют не указывать действие, т.к. это действие --- всегда \verb|wait|. Для ключевых слов, читающих и записывающих значения атрибутов, действием по умолчанию является \verb|get|.

В тех случаях, когда в одном ключевом слове указывается множество операций с атрибутами, сначала выполняется ожидание (\verb|wait|), потом взятие значений (\verb|get|, внутри списка действий \verb|get| порядок выполнения определяется по алфавитному порядку имён атрибутов), потом действия \verb|do|, наконец, \verb|set|. При этом тот порядок, в котором действия перечислены в параметрах ключевого слова, не играет никакой роли и не определяет порядка выполнения.

Пример, приводимый ниже --- команда работы с атрибутами элемента GUI (\verb|list|). Ждёт не долее 5 секунд момента, когда в списке будет ровно шесть объектов, а сам список будет доступен для редактирования (enabled), после чего выбирает в нём элемент с индексом 1.
\begin{verbatim}
Ctl Attr    ${list}    wait num_items    6    wait enabled 
... set idx_selected    1    timeout    5s
\end{verbatim}


\subsubsection{Таблица атрибутов объектов}

\begin{center}
	\begin{tabular}{|p{90pt}|p{120pt}|p{100pt}|p{60pt}|}\hline
		\textbf{Атрибут} & \textbf{Смысл} & \textbf{Объекты} & \textbf{Операции и параметры} \\ \hline
		\verb|id| & Id объекта & Окна и все элементы GUI & \verb|get <>|, \verb|wait <val>| \\ \hline
		\verb|re_id| & Id объекта для сравнения по регулярному выражению & Окна и все элементы GUI & \verb|wait <val>| \\ \hline
		\verb|automation_id| & Automation Id объекта & Окна и все элементы GUI & \verb|get <>|, \verb|wait <val>| \\ \hline
		\verb|re_automation_id| & Automation Id объекта для сравнения по регулярному выражению & Окна и все элементы GUI & \verb|wait <val>| \\ \hline
		\verb|click|, \verb|dclick|, \verb|rclick| & Атрибут-действие для щелчков мышью & Окна и все элементы GUI & \verb|do <>| \\ \hline
		\verb|focus| & Фокус ввода (узнать, принадлежит ли, или установить) & Элементы GUI, могущие получать фокус & \verb|get <>|, \verb|set <>|  \\ \hline		
		\verb|items| & Подэлементы данного элемента & Элементы GUI с подэлементами (список и т.п.) & \verb|get <>| \\ \hline				
		\verb|text| & Текст элемента, чтение, у некоторых --- и запись & Элементы GUI с подэлементами (список и т.п.) & \verb|get <>|, \verb|set <val>| \\ \hline				
		\verb|texts| & Список текстов всех подэлементов, у которых есть \verb|text| & Окна, элементы GUI & \verb|get <>| \\ \hline
		\verb|merged_texts| & Как \verb|texts|, но все тексты списка объединены в одну строку с \verb"'\n'" в качестве разделителя & Окна, элементы GUI & \verb|get <>| \\ \hline
		\verb|closed| и \verb|not_closed| & Отображается или нет (минимизировано) & Окна & \verb|get <>|,  \verb|wait <>|\\ \hline
		\verb|active| и \verb|not_closed| & Активно или нет & Окна & \verb|get <>|,  \verb|wait <>| \\ \hline
		\verb|enabled| и \verb|disabled| & Разрешено/запрещено & Элементы GUI & \verb|get <>|,  \verb|wait <>|\\ \hline
		\verb|num_items| & Число объектов внутри & Элементы GUI, содержащие объекты, например, \verb|list| & \verb|get <>|,  \verb|wait <val>|\\ \hline
		\verb|items| & Список объектов внутри & Элементы GUI, содержащие объекты, например, \verb|list| & \verb|get <>|\\ \hline		
		\verb|selected|,  \verb|idx_selected|& Число объектов внутри & Элементы GUI, содержащие объекты, например, \verb|list| & \verb|get <>|,  \verb|wait <val>|\\ \hline		
		
		\verb|enabled| и \verb|disabled| & Элементы GUI & Окна & \verb|get <>|,  \verb|wait <>|\\ \hline
		
	\end{tabular}
\end{center}


\subsection{Строгий режим команд ожидания и проверки состояния}

Включается параметром-флагом \verb|assert|, присутствие которого всегда приводит к одному и тому же результату, не зависящему от ключевого слова: если ключевое слово не смогло дождаться требуемого состояния объектов, с которыми работает (на само требуемое состояние влияют как рассмотренные выше критерии успешности, так и многие специфические для отдельных ключевых слов параметры), оно не возвращает результат, а выбрасывает исключение, которое, если в коде на языке \verb|Robot| не принято специальных мер, приводит к тому, что тест терпит неудачу.

\chapter{Описание ключевых слов}

\section{Группа Proc}
Ключевые слова группы \verb"Proc" позволяют получать список запущенных процессов и фильтровать его. Впоследствии возможно подключение к процессам с целью дальнейшего управления ими с помощью \verb"App Attach".

\subsection{Proc List (получение списка процессов)}
Это ключевое слово возвращает полный список объектов, описывающих процессы в системе.


\subsubsection*{Название} 
\verb"Proc List"

\subsubsection*{Позиционные параметры} 
Нет

\subsubsection*{Именованые параметры} 
Нет


\subsubsection*{Возвращаемое значение} 
Список объектов <<процесс>>.

\subsubsection*{Примеры}
\begin{verbatim}@{pl}=    Proc List\end{verbatim}



\subsection{Proc Filter (фильтрация списка процессов)}
Фильтрует список процессов, полученный с помощью \verb"Proc List", либо оставляя в нём только те процессы, которые подходят по критериям фильтрации, либо же выбрасывая их (т.е. оставляя не подходящие --- в варианте с флагом \verb"negative").



\subsubsection*{Название} 
\verb"Proc Filter"

\subsubsection*{Позиционные параметры} 

\verb"li" --- список процессов

\subsubsection*{Именованые параметры} 


\verb"negative" (флаг) --- <<фильтровать наоборот>>. Оставляет в выходном списке то, что не подходит под критерии.

Кроме того, поддерживается полный набор стандартных параметров, кроме тайм-аута --- \verb"single", \verb|any|, \verb|all|, \verb|none|, \verb|number| и \verb"assert".

\subsubsection*{Поддерживаемые атрибуты} 

Для всех этих атрибутов поддерживается только действие \verb|wait|:

\begin{itemize}
	\item \verb"id" и \verb"re_id";
	\item \verb"name" и \verb"re_name";
	\item \verb"title" и \verb"re_title".
\end{itemize}



\subsubsection*{Возвращаемое значение} 
Список объектов <<процесс>> (обычно), если нет флага \verb"single", либо один процесс (при флаге \verb"single", если результатом является ровно один процесс), либо \verb"False" (при флаге \verb"single", если результатом является не один процесс; если указан флаг \verb"assert", вместо возвращения \verb"False" выбрасывается ошибка).

\subsubsection*{Примеры}
Оставить в списке \verb"@{pl}" только процессы с именем \verb"notepad":
\begin{verbatim}@{pl}=    Proc List
@{pl}=    Proc Filter    ${pl}    name    notepad\end{verbatim}

Оставить в списке \verb"@{pl}" только процессы не с именем \verb"notepad":
\begin{verbatim}@{pl}=    Proc Filter    ${pl}   negative    name    notepad\end{verbatim}

Найти единственный процесс с именем \verb"notepad", если не получится найти ровно один, выбросить ошибку:
\begin{verbatim}${p}=    Proc Filter    ${pl}   name    notepad    single    assert\end{verbatim}



\section{Группа App}
Ключевые слова группы \verb"App" обеспечивают работу с приложениями: их запуск, проверку состояния (выполняется/завершено), ожидание завершения или запуска и т.п.


\subsection{App Launch (запуск приложения)}
Это ключевое слово выполняет запуск приложения из файла, путь к которому задаётся его позиционным параметром \verb"executable". Поиск производится с учётом системных путей (включая переменную \verb"PATH").


\subsubsection*{Название} 
\verb"App Launch"

\subsubsection*{Позиционные параметры} 

\verb"executable" --- путь к исполняемому файлу. Поиск будет производиться по системным путям, включая \verb"PATH".

\subsubsection*{Именованые параметры} 
\verb"params" (значение --- строка) --- строка параметров запуска, передаваемых приложению. Внимание: все параметры в одной строке!

\verb"test_teardown" (флаг) --- если приложение не завершится к концу теста, его следует принудительно завершить. Не сочетается со \verb"suite_teardown".

\verb"suite_teardown" (флаг) --- если приложение не завершится к концу сюиты, его следует принудительно завершить. Не сочетается с \verb"test_teardown".

\verb"assert" (флаг) --- выполнение ключевого слова терпит неудачу, если запуск не произведён успешно.

\subsubsection*{Возвращаемое значение} 
При успехе --- объект, соответствующий приложению. При неудаче возвращается \verb"None", если не указан флаг \verb"assert". Если флаг \verb"assert" указан, выбрасывается та ошибка, которая привела к неудаче запуска.

\subsubsection*{Примеры}
Запустить \verb"ipy.exe" со строкой параметров \verb"wf.py". Если не завершится до конца теста, должно быть завершено аварийно. В случае ошибки запуска не возвращать \verb"None", а потерпеть неудачу:

\begin{verbatim}App Launch    ipy.exe    test_teardown    params    wf.py    assert\end{verbatim}




\subsection{App Attach (присоединение к приложениям)}
Получает процесс или список процессов. Возвращает приложение или список приложений. Может регистрировать приложения для завершения в конце теста или сюиты.

\subsubsection*{Название} 
\verb"App Attach"

\subsubsection*{Позиционные параметры} 

\verb"proc" --- процесс либо список процессов.

\subsubsection*{Именованые параметры} 
\verb"test_teardown" (флаг) --- если приложения не завершатся к концу теста, их следует принудительно завершить. Не сочетается со \verb"suite_teardown".

\verb"suite_teardown" (флаг) --- если приложения не завершатся к концу сюиты, их следует принудительно завершить. Не сочетается с \verb"test_teardown".

\subsubsection*{Возвращаемое значение} 
Объект, соответствующий приложению.

\subsubsection*{Примеры}
Запустить \verb"ipy.exe" со строкой параметров \verb"wf.py". Если не завершится до конца теста, должно быть завершено аварийно. В случае ошибки запуска не возвращать \verb"None", а потерпеть неудачу:

\begin{verbatim}
@{pl}=    Proc List
${p}=    Proc Filter    @{pl}   name    notepad    single    assert
${app}=    App Attach   ${p}    test_teardown
\end{verbatim}



\subsection{App State (управление состоянием приложений)}
Позволяет проверять состояние приложения или списка приложений (работает/завершено), ждать нужного состояния и завершать приложения при необходимости. 


\subsubsection*{Название} 
\verb"App State"

\subsubsection*{Позиционные параметры} 

\verb"app" --- объект приложения или список таких объектов (выдаваемый \verb"App Launch" и \verb"App Attach").

\subsubsection*{Именованые параметры} 
\verb"params" (значение --- строка) --- строка параметров запуска, передаваемых приложению. Внимание: все параметры в одной строке!

\verb"running" (флаг) --- желаемым состоянием приложения (или приложений) вляется запущенное. Несовместимо с \verb"not_running" и \verb"kill"

\verb"not_running" (флаг) --- желаемым состоянием приложения вляется завершённое. Если указано ожидание, то это ожидание завершения. Результат операции положителен, если приложение завершилось. Несовместимо с \verb"running" и \verb"kill"

\verb"kill" (флаг) --- желаемым состоянием приложения вляется завершённое. Однако если приложение запущено (в случае ожидания --- не удалось дождаться выхода), его следует аварийно завершить. Несовместимо c \verb"running" и \verb"not_running".

\verb"timeout" (значение параметра --- спецификация времени ожидания) --- параметр, указывающий на необходимость ожидания.

Кроме того, поддерживается полный набор стандартных параметров, кроме тайм-аута --- \verb"single", \verb|any|, \verb|all|, \verb|none|, \verb|number| и \verb"assert". 


\subsubsection*{Возвращаемое значение}

Если на вход был передан список приложений, то возвращается список булевских значений. Однако если передан был одиночный объект, не обёрнутый в список, возвращается булевский флаг, также не обёрнутый в список. К такому же эффекту приводит параметр \verb|single| (возвращается объект или \verb|None|) и \verb|None| (возвращается булевский флаг без оборачивания в список).

\verb"assert" работает стандартным образом.

\subsubsection*{Примеры}

Проверить, завершено ли приложение, вернуть результат:
\begin{verbatim}${v}=    App State    ${app}    not_running\end{verbatim}

Убедиться, что приложение завершено, если нет, потерпеть неудачу:
\begin{verbatim}App State    ${app}    not_running    assert\end{verbatim}

Завершить приложение принудительно:
\begin{verbatim}App State    ${app}    kill\end{verbatim}

Завершить приложение принудительно, если оно само не завершится за 5 секунд, вернуть результат (удалось ли дождаться):
\begin{verbatim}App State    ${app}    timeout    5s    kill\end{verbatim}

Завершить приложение принудительно, если оно само не завершится за 5 секунд, если пришлось завершать, выбросить ошибку:
\begin{verbatim}App State    ${app}    timeout    5s    kill    assert\end{verbatim}

Если приложение не завершится за 5 секунд, выбросить ошибку:
\begin{verbatim}App State    ${app}    timeout    5s    assert    not_running\end{verbatim}


\section{Группа Wnd}
Ключевые слова группы \verb"Wnd" предоставляют средства поиска окон, ожидания из появления и закрытия, посылки окну сигнала на закрытие и т.п.


\subsection{Wnd Get (поиск окон с возможностью ожидания)}
Реализует все основные сценарии поиска окон, как верхнего уровня, так и в пределах приложения. Также позволяет выполнять ожидание открытия (или, наоборот, закрытия) окна.

\subsubsection*{Название}
\verb"Wnd Get"

\subsubsection*{Позиционные параметры}

Нет

\subsubsection*{Именованые параметры} 
\verb"app" (значение --- объект приложения) --- приложение, среди окон которого производится поиск. Если параметр не указан, поиск производится среди окон верхнего уровня.

Поддерживаются все стандартные именованые параметры --- \verb"single", \verb|any|, \verb|all|, \verb|none|, \verb|number|, \verb"assert" и \verb"timeout".


\subsubsection*{Поддерживаемые атрибуты} 

Для всех этих атрибутов поддерживается только действие \verb|wait|:

\begin{itemize}
\item \verb"active"/\verb"not_active";
\item \verb"closed"/\verb"not_closed";
\item \verb"id" и \verb"re_id";
\item \verb"automation_id" и \verb"re_automation_id";
\item \verb"title" и \verb"re_title".
\end{itemize}

\subsubsection*{Возвращаемое значение}
Если не задан один из флагов \verb"single" или \verb"none", всегда возвращает список найденных объектов <<окно>>. Если упомянутые флаги заданы, то правила таковы. \verb"none" заставляет вернуть булевское значение (\verb"True" --- окна не найдены, \verb"False" --- окна найдены). \verb"single" стремится вернуть объект <<окно>> или пустой объект \verb"None".

\verb"assert" работает стандартным образом.


\subsubsection*{Примеры}
На рабочем столе должно быть ровно одно окно верхнего уровня, заголовок которого соответствует регулярному выражению <<\verb"^.*ipy64\.exe$">>. Ждать этого не более 5 секунд, дождавшись --- вернуть объект <<окно>>, а не дождавшись --- выбросить исключение:

\begin{verbatim}
${win1}=    Wnd Get    re_title    ^.*ipy64\.exe$    single    assert
...     timeout    5s
\end{verbatim}

Ждать полного закрытия всех окон приложения \verb"${app2}" не более 5 секунд. Не дождавшись, выбросить исключение. Дождавшись, вернуть \verb"True"
\begin{verbatim}
Wnd Get    app    ${app2}    none    timeout    5s    assert
\end{verbatim}

Получить список всех окон приложения \verb"${app1}", поместить его в список \verb"@{li}". Затем вычисляется длина списка и заносится в переменную \verb"${l}". Обратите особое внимание, что при передаче списка ключевому слову \verb"Get Length" список указан не как \verb"@{li}", а как \verb"${li}", в противном случае значения, лежащие в списке, стали бы каждый отдельным параметром ключесвого слова:
\begin{verbatim}
@{li}=    Wnd Get    app    ${app1}
${l}=    Get Length    ${li}
\end{verbatim}



\subsection{Wnd Filter (фильтрация списка окон)}
Фильтрует ранее полученный список окон по заданным критериям. По парамтрам близко к \verb"Wnd Get", но, естественно, имеет позиционный параметр (исходный список окон) и не предоставлят функциональности ожидания. Дополнительный параметр по сравнение с \verb"Wnd Get" --- \verb"negative".

\subsubsection*{Название}
\verb"Wnd Filter"

\subsubsection*{Позиционные параметры} 

\verb"wlist" -- исходный список окон.

\subsubsection*{Именованые параметры} 

Поддерживается набор стандартных параметров, из которых имеют смысл \verb"single", \verb|none|, \verb|number| и \verb"assert""


\verb"negative" (флаг) --- инверсия условий поиска. Вместо обычного отбора тех элементов списка, которые соответствуют критериям поиска, из списка выбрасываются параметры, соответствующие критериям поиска. Важная деталь: сначала поиск выполняется так, как если бы данного флага не было (все заданные в параметрах критерии применяются по <<И>>, т.е. найденные на этом этапе окна удовлетворяют всем критериям). Потом результат <<инвертируется>>, т.е. в результат попадают те окна из исходного набора, которые не были отобраны по критериям.


\subsubsection*{Поддерживаемые атрибуты} 

Для всех этих атрибутов поддерживается только действие \verb|wait|:

\begin{itemize}
	\item \verb"active"/\verb"not_active";
	\item \verb"closed"/\verb"not_closed";
	\item \verb"id" и \verb"re_id";
	\item \verb"automation_id" и \verb"re_automation_id";
	\item \verb"title" и \verb"re_title".
\end{itemize}



\subsubsection*{Возвращаемое значение}
Если не задан один из флагов \verb"single" или \verb"none", всегда возвращает список найденных объектов <<окно>>. Если упомянутые флаги заданы, то правила таковы. \verb"none" заставляет вернуть булевское значение (\verb"True" --- окна не найдены, \verb"False" --- окна найдены), либо выбросить вместо возвращения \verb"False" исключение, если задан параметр \verb"assert". \verb"single" стремится вернуть объект <<окно>> или пустой объект \verb"None", но при наличии флага \verb"assert" вместо возвращения \verb"None" выбросит исключение.



\subsubsection*{Примеры}
Получив все окна верхнего уровня, отфильтруем список так, чтобы удалить из него окна с заголовком \verb"ipy64.exe":

\begin{verbatim}
@{wl}=    Wnd Get
@{wl}=    Wnd Filter    ${wl}    negative    title    ipy64.exe
\end{verbatim}


\subsection{Wnd Attr (работа с атрибутами окон)}
Оперирует атрибутами окон.


\subsubsection*{Название} 
\verb"Wnd Attr"

\subsubsection*{Позиционные параметры} 
\verb"li" -- список окон или один объект <<окно>>. В случае списка будут закрыты все.

\subsubsection*{Именованые параметры} 
\verb"assert" изменяет поведение стандартным для себя образом. Выбрасывает исключение в том случае, если есть операции ожидания, а дождаться не удалось.
\verb"timeout" указывает величину ожидания.

\subsubsection*{Поддерживаемые атрибуты} 

Поддерживаются все разрешённые для атрибутов действия:

\begin{itemize}
	\item \verb"active"/\verb"not_active";
	\item \verb"closed"/\verb"not_closed";
	\item \verb"id" и \verb"re_id";
	\item \verb"automation_id" и \verb"re_automation_id";
	\item \verb"title" и \verb"re_title";
	\item \verb"close" (действие \verb"do" закрывает окно).
\end{itemize}

\subsubsection*{Возвращаемое значение} 
Список результатов для каждого из объектов (или один такой результат, если на вход был подан объект, а не список объектов).

Для каждого из объектов соответствующий элемент списка --- результат операции \verb|get|, а если этих операций несколько --- список результатов (упорядоченный по имени атрибута).

\subsubsection*{Примеры}
\begin{verbatim}Wnd Attr    ${li}    do close\end{verbatim}





\section{Группа Ctl}
Ключевые слова группы \verb"Ctl" позволяют искать элементы GUI и оперировать ими.

\subsection{Ctl Get (поиск атрибутов)}
Это ключевое слово возвращает полный список объектов, описывающих процессы в системе.


\subsubsection*{Название} 
\verb"Ctl Get"

\subsubsection*{Позиционные параметры} 
Нет

\subsubsection*{Именованые параметры}

Стандартный набор, связанный с условиями завершения и ожиданием.

\subsubsection*{Поддерживаемые атрибуты} 

Полный набор атрибутов элементов GUI с действием \verb|wait|.

\subsubsection*{Возвращаемое значение} 
Список объектов <<процесс>>.

\subsubsection*{Примеры}
\begin{verbatim}@{pl}=    Proc List\end{verbatim}






\end{document}
